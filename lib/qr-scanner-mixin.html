<link rel="import" href="../bower_components/polymer/lib/utils/mixin.html">

<script type="module">
  import QrScanner from "./qr-scanner.min.js";
    window.QrScanner = QrScanner;
</script>
<script>
window.Mixins = window.Mixins || {};

  /**
   * 
   * @polymerMixin
   * @mixinFunction
   */
  Mixins.QrScannerMixin = Polymer.dedupingMixin((base) => {
    /**
     * @polymerMixinClass
     * @implements { }
     */
    class QrScannerMixin extends base {
      /**
        * Object describing property-related metadata used by Polymer features
        */
      static get properties() {
        return {
          workerPath: {
            type: String,
            value: 'lib/qr-scanner-worker.min.js',
            observer: '_setWorkerPath'
          }
        };
      }
      /**
        * Instance of the element is created/upgraded. Useful for initializing
        * state, set up event listeners, create shadow dom.
        * @constructor
        */
      constructor() {
        super();
      
        this.QrScanner = window.QrScanner;

      }

      _setWorkerPath(path) {
        if (!path) return false;
        this.QrScanner.WORKER_PATH = path;
        return true;
      }


    //   _getWorkerUrl(workerScripts) {
    //     const jsMimeType = { type: 'text/javascript' },
    //       workerCodeExtractor = oScript => oScript.textContent,
    //       workerCode = Array.prototype.map.call(workerScripts, workerCodeExtractor),
    //       workerMessageHandler = this._handleWorkerMessage.bind(this),
    //       blob = new Blob(workerCode, jsMimeType),
    //       objectUrl = window.URL.createObjectURL(blob);
    //       return objectUrl;
    //   }

    //   _getScript(path) {
    //     return new Promise(function (resolve, reject) {
		// 		const req = new XMLHttpRequest();

		// 		req.open('GET', path);

		// 		req.onload = function () {
		// 			if (req.status === 200) {
		// 				script.textContent = req.response + script.textContent;
		// 				script.removeAttribute('src');
		// 				resolve(req.response);
		// 			} else {
		// 				reject(new Error(req.statusText));
		// 			}
		// 		};

		// 		req.onerror = function () {
		// 			reject(new Error('Network Error'));
		// 		};

		// 		req.send();
		// 	});
    //   }
    // }
    return QrScannerMixin;
  });

</script>